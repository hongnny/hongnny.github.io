<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.0">
<title data-rh="true">用css新特性优化长列表 | JonBen</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://jonbenery.github.io/blog/contentVisibility"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="用css新特性优化长列表 | JonBen"><meta data-rh="true" name="description" content="废话不多说，该属性为 content-visibility"><meta data-rh="true" property="og:description" content="废话不多说，该属性为 content-visibility"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2023-01-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/endiliey"><meta data-rh="true" property="article:tag" content="javascript"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://jonbenery.github.io/blog/contentVisibility"><link data-rh="true" rel="alternate" href="https://jonbenery.github.io/blog/contentVisibility" hreflang="en"><link data-rh="true" rel="alternate" href="https://jonbenery.github.io/blog/contentVisibility" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="JonBen RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="JonBen Atom Feed"><link rel="stylesheet" href="/assets/css/styles.7a5fc62b.css">
<link rel="preload" href="/assets/js/runtime~main.5a1768f9.js" as="script">
<link rel="preload" href="/assets/js/main.90638bb1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="no pains no gains" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="no pains no gains" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">零下6℃</b></a><a class="navbar__item navbar__link" href="/docs/">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a><a class="navbar__item navbar__link" href="/openApi">openApi</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jonbenery/weblog" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All our posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/beforeunload">页面离开时阻止页面刷新</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/computedTime">根据时间戳计算出具体时间</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/contentVisibility">用css新特性优化长列表</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/dragDir">拖拽获取文件夹下的所有文件</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/elementDrag">多层级元素拖放</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/fileDownload">前端文件下载的方式</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/getImageRatio">计算图片等比缩放后的宽高</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/getRandomUid">获取一个随机不重复的字符串</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/mousemoveSimulationScroll">鼠标的拖拽模拟滚动条滚动</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/syncScrolling">两个列表区域同步滚动</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">用css新特性优化长列表</h1><div class="container_mt6G margin-vert--md"><time datetime="2023-01-30T00:00:00.000Z" itemprop="datePublished">January 30, 2023</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/endiliey" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/endiliey.png" alt="赵锦彬"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/endiliey" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">赵锦彬</span></a></div><small class="avatar__subtitle" itemprop="description">coder javascript</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>废话不多说，该属性为 <code>content-visibility</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-何为-content-visibility">1. 何为 content-visibility？<a href="#1-何为-content-visibility" class="hash-link" aria-label="Direct link to 1. 何为 content-visibility？" title="Direct link to 1. 何为 content-visibility？">​</a></h2><p><code>content-visibility</code> ：属性控制一个元素是否渲染其内容，它允许用户代理（浏览器）潜在地省略大量布局和渲染工作，直到需要它为止。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>MDN 原文</div><div class="admonitionContent_S0QG"><p>The content-visibility CSS property controls whether or not an element renders its contents at all, along with forcing a strong set of containments, allowing user agents to potentially omit large swathes of layout and rendering work until it becomes needed. Basically it enables the user agent to skip an element&#x27;s rendering work (including layout and painting) until it is needed — which makes the initial page load much faster.</p></div></div><p>它有几个常见的取值。</p><div class="language-CSS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-CSS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">content-visibility: visible;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-visibility: hidden;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">content-visibility: auto;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>分别解释一下：</p><ul><li><code>content-visibility: visible</code> ：默认值，没有任何效果，相当于没有添加 <code>content-visibility</code>，元素的渲染与往常一致。</li><li><code>content-visibility: hidden</code> ：与 <code>display: none</code> 类似，用户代理将跳过其内容的渲染。（这里需要注意的是，跳过的是内容的渲染）</li><li><code>content-visibility: auto</code> ：如果该元素不在屏幕上，并且与用户无关，则不会渲染其后代元素。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-contain-intrinsic-size">2. contain-intrinsic-size<a href="#2-contain-intrinsic-size" class="hash-link" aria-label="Direct link to 2. contain-intrinsic-size" title="Direct link to 2. contain-intrinsic-size">​</a></h2><p>当然，除 <code>content-visibility</code> 之外，还有一个与之配套的属性 <code>contain-intrinsic-size</code>。</p><p><code>contain-intrinsic-size</code> ：控制由 <code>content-visibility</code> 指定的元素的自然大小。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-利用-content-visibility-hidden-优化展示切换性能">3. 利用 content-visibility: hidden 优化展示切换性能<a href="#3-利用-content-visibility-hidden-优化展示切换性能" class="hash-link" aria-label="Direct link to 3. 利用 content-visibility: hidden 优化展示切换性能" title="Direct link to 3. 利用 content-visibility: hidden 优化展示切换性能">​</a></h2><p>首先，假设我们有两个 DIV 包裹框：</p><div class="language-html codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-html codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">g-wrap</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">1111</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">hidden</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">2222</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>设置两个 div 为 200x200 的黑色块：</p><div class="language-CSS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-CSS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.g-wrap &gt; div {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  width: 60px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  height: 60px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  background: #000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>效果如下：</p><div class="g-wrap"><div style="width:60px;height:60px;line-height:60px;text-align:center;color:#fff;background:#000;margin-bottom:10px">1111</div><div style="width:60px;height:60px;line-height:60px;text-align:center;color:#fff;background:#000;margin-bottom:10px">2222</div></div><p>OK，没有问题，接下来，我们给其中的 <code>.hidden</code> 设置 <code>content-visibility: hidden</code>，看看会发生什么：</p><div class="language-CSS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-CSS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.hidden {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content-visibility: hidden;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>效果如下：</p><div class="g-wrap"><div style="width:60px;height:60px;line-height:60px;text-align:center;color:#fff;background:#000;margin-bottom:10px">1111</div><div style="content-visibility:hidden;width:60px;height:60px;line-height:60px;text-align:center;color:#fff;background:#000;margin-bottom:10px">2222</div></div><p>注意，仔细看效果，这里添加了 <code>content-visibility: hidden</code> 之后，<strong>消失的只是添加了该元素的 <code>div</code> 的子元素消失不见，而父元素本身及其样式，还是存在页面上的。</strong></p><p>如果我们去掉设置了 <code>content-visibility: hidden</code> 的元素本身的 <code>width</code>、<code>height</code>、<code>padding</code>、<code>margin</code> 等属性，则元素看上去就如同设置了 <code>display: none</code> 一般，在页面上消失不见了。</p><p>那么，<code>content-visibility: hidden</code> 的作用是什么呢？</p><p>设置了 <code>content-visibility: hidden</code> 的元素，<strong>其元素的子元素将被隐藏，但是，它的渲染状态将会被缓存</strong>。所以，当 <code>content-visibility: hidden</code> 被移除时，用户代理无需重头开始渲染它和它的子元素。</p><p>因此，如果我们将这个属性应用在一些一开始需要被隐藏，但是其后在页面的某一时刻需要被渲染，或者是一些需要被频繁切换显示、隐藏状态的元素上，其渲染效率将会有一个非常大的提升。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-利用-content-visibility-auto-实现懒加载或虚拟列表">4. 利用 content-visibility: auto 实现懒加载或虚拟列表<a href="#4-利用-content-visibility-auto-实现懒加载或虚拟列表" class="hash-link" aria-label="Direct link to 4. 利用 content-visibility: auto 实现懒加载或虚拟列表" title="Direct link to 4. 利用 content-visibility: auto 实现懒加载或虚拟列表">​</a></h2><p>OK，接下来是 <code>content-visibility</code> 的核心用法，利用 <code>auto</code> 属性值。</p><p><code>content-visibility: auto</code> 的作用是，如果该元素不在屏幕上，并且与用户无关，则不会渲染其后代元素。是不是与 <code>LazyLoad</code> 非常类似。</p><p>我们来看这样一个 DEMO ，了解其作用：</p><p>假设，我们存在这样一个 HTML 结构，含有大量的文本内容：</p><div class="language-HTML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-HTML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;div class=&quot;g-wrap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div class=&quot;paragraph&quot;&gt;...&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // ... 包含了 N 个 paragraph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div class=&quot;paragraph&quot;&gt;...&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/div&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每个 <code>.paragraph</code> 的内容如下</p><div class="language-HTML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-HTML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Lorem Start!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lorem ipsum dolor sit amet consectetur adipisicing elit.Nonvitae voluptates maxime solutaimpedit doloremque atque quasi dignissimosdelectus distinctio aut commodieaque nostrum maiores nulla! Ipsum voluptatibus alias suscipit!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lorem ipsum dolor sit amet consectetur adipisicingelit.Non vitae voluptates maxime solutaimpedit doloremque atque quasi dignissimos,delectus distinctio aut commodi eaque nostrum maiores nulla! Ipsum voluptatibus alias suscipit!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lorem End!</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>因此，整个的页面看起来就是这样的：</p><div class="preview_wToN" style="width:600px"><img class="img_MFLS" src="../../img/web/content.visibility.1.gif" alt=""><div></div></div><p>由于，我们没有对页面内容进行任何处理，因此，所有的 <code>.paragraph</code> 在页面刷新的一瞬间，都会进行渲染，看到的效果就如上所示。</p><p>当然，现代浏览器愈加趋于智能，基于这种场景，其实我们非常希望对于仍未看到，仍旧未滚动到的区域，可以延迟加载，只有到我们需要展示、滚动到该处时，页面内容才进行渲染。</p><p>基于这种场景，<code>content-visibility: auto</code> 就应运而生了，它允许浏览器对于设置了该属性的元素进行判断，如果该元素当前不处于视口内，则不渲染该元素。</p><p>我们基于上述的代码，只需要最小化，添加这样一段代码：</p><div class="language-CSS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-CSS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.paragraph {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content-visibility: auto;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>再看看效果，仔细观察右侧的滚动条：</p><div class="preview_wToN" style="width:600px"><img class="img_MFLS" src="../../img/web/content.visibility.2.png" alt=""><div></div></div><p>可能你还没意识到发生了什么，我们对比下添加了 <code>content-visibility: auto</code> 和没有添加 <code>content-visibility: auto</code> 的两种效果下文本的整体高度：</p><div class="preview_wToN" style="width:600px"><img class="img_MFLS" src="../../img/web/content.visibility.3.png" alt=""><div></div></div><p>有着非常明显的差异，这是因为，设置了 <code>content-visibility: auto</code> 的元素，在非可视区域内，目前并没有被渲染，因此，右侧内容的高度其实是比正常状态下少了一大截的。</p><p>我们实际开始进行滚动，看看会发生什么：</p><div class="preview_wToN" style="width:600px"><img class="img_MFLS" src="../../img/web/content.visibility.4.gif" alt=""><div></div></div><p>由于下方的元素在滚动的过程中，出现在视口范围内才被渲染，因此，滚动条出现了明显的飘忽不定的抖动现象。（当然这也是使用了 <code>content-visibility: auto</code> 的一个小问题之一），不过明显可以看出，这与我们通常使用 JavaScript 实现的懒加载或者延迟加载非常类似。</p><p>当然，与懒加载不同的是，在向下滚动的过程中，上方消失的已经被渲染过且消失在视口的元素，也会因为消失在视口中，重新被隐藏。因此，即便页面滚动到最下方，整体的滚动条高度还是没有什么变化的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-利用-contain-intrinsic-size-解决滚动条抖动问题">5. 利用 contain-intrinsic-size 解决滚动条抖动问题<a href="#5-利用-contain-intrinsic-size-解决滚动条抖动问题" class="hash-link" aria-label="Direct link to 5. 利用 contain-intrinsic-size 解决滚动条抖动问题" title="Direct link to 5. 利用 contain-intrinsic-size 解决滚动条抖动问题">​</a></h2><p>从上面的例子，也能看到，在利用 <code>content-visibility: auto</code> 处理长文本、长列表的时候。在滚动页面的过程中，滚动条一直在抖动，这不是一个很好的体验。</p><p>好在，规范制定者也发现了这个问题。这里我们可以使用另外一个 <code>CSS</code> 属性，也就是文章一开头提到的另外一个属性 <code>contain-intrinsic-size</code> 来解决这个问题。</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>MDN</div><div class="admonitionContent_S0QG"><p><code>contain-intrinsic-size</code> ：控制由 <code>content-visibility</code> 指定的元素的自然大小。</p></div></div><p>什么意思呢？还是上面的例子</p><div class="language-HTML codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-HTML codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;div class=&quot;g-wrap&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;div class=&quot;paragraph&quot;&gt;...&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // ... 包含了 N 个 paragraph</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;div class=&quot;paragraph&quot;&gt;...&lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/div&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们不使用 <code>contain-intrinsic-size</code>，只对视口之外的元素使用 <code>content-visibility: auto</code>，那么视口外的元素高度通常就为 0。导致实际的滚动效果，滚动条就是抖动的。</p><p>所以，我们可以同时利用上 <code>contain-intrinsic-size</code>，如果能准确知道设置了 <code>content-visibility: auto</code> 的元素在渲染状态下的高度，就填写对应的高度。如果如法准确知道高度，也可以填写一个大概的值：</p><div class="language-CSS codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-CSS codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.paragraph {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  content-visibility: auto;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  contain-intrinsic-size: 320px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如此之后，浏览器会给未被实际渲染的视口之外的 <code>.paragraph</code> 元素一个高度，避免出现滚动条抖动的现象：</p><div class="preview_wToN" style="width:600px"><img class="img_MFLS" src="../../img/web/content.visibility.5.gif" alt=""><div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="6content-visibility-的一些其他问题">6.content-visibility 的一些其他问题<a href="#6content-visibility-的一些其他问题" class="hash-link" aria-label="Direct link to 6.content-visibility 的一些其他问题" title="Direct link to 6.content-visibility 的一些其他问题">​</a></h2><p>目前兼容性还是比较惨淡的，需要再等待一段时间。当然，由于该属性属于渐进增强一类的功能，即便失效，也完全不影响页面本身的展示。
同时，也有一些同学表示，利用 <code>content-visibility: auto</code> 只能解决部分场景，在海量 DOM 的场景下的实际效果，还有待进一步的实测。真正运用的时候，多做对比，再做取舍。
当然，现代浏览器已经越来越智能，类似 <code>content-visibility</code> 功能的属性也越来越多，我们在性能优化的路上有了更多选择，总归是一件好事。</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/javascript">javascript</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/jonbenery/weblog/blog/2023-01-30-contentVisibility/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/computedTime"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">根据时间戳计算出具体时间</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/dragDir"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">拖拽获取文件夹下的所有文件</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-何为-content-visibility" class="table-of-contents__link toc-highlight">1. 何为 content-visibility？</a></li><li><a href="#2-contain-intrinsic-size" class="table-of-contents__link toc-highlight">2. contain-intrinsic-size</a></li><li><a href="#3-利用-content-visibility-hidden-优化展示切换性能" class="table-of-contents__link toc-highlight">3. 利用 content-visibility: hidden 优化展示切换性能</a></li><li><a href="#4-利用-content-visibility-auto-实现懒加载或虚拟列表" class="table-of-contents__link toc-highlight">4. 利用 content-visibility: auto 实现懒加载或虚拟列表</a></li><li><a href="#5-利用-contain-intrinsic-size-解决滚动条抖动问题" class="table-of-contents__link toc-highlight">5. 利用 contain-intrinsic-size 解决滚动条抖动问题</a></li><li><a href="#6content-visibility-的一些其他问题" class="table-of-contents__link toc-highlight">6.content-visibility 的一些其他问题</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">博客</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">联系方式</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:592926483@qq.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">邮箱： 592926483@qq.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/jonbenery/weblog" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">AGPL-3.0 Licensed | Copyright © 2023 weblog, Inc. Built with Jonben.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.5a1768f9.js"></script>
<script src="/assets/js/main.90638bb1.js"></script>
</body>
</html>